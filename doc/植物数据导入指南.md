# 植物数据导入指南

## 📋 前提条件

1. ✅ 已安装MySQL数据库
2. ✅ MySQL服务正在运行
3. ✅ 已安装Python 3.x
4. ✅ 已安装mysql-connector-python包

## 🚀 导入步骤

### 方法1: 交互式导入(推荐)

1. 打开终端,进入项目目录:
```bash
cd g:\work\zhiwuzhushou-master
```

2. 运行导入脚本:
```bash
python scripts/import_plants_to_db.py
```

3. 按提示输入数据库配置:
```
数据库地址 [localhost]: (直接回车使用localhost)
数据库用户名 [root]: (直接回车使用root)
数据库密码: (输入你的MySQL密码)
数据库名 [plant_assistant]: (直接回车使用plant_assistant)
```

4. 脚本会自动:
   - 创建数据库(如果不存在)
   - 创建plants表(如果不存在)
   - 添加缺失的字段(如history)
   - 导入1000条植物数据

### 方法2: 使用SQL直接导入

如果Python导入遇到问题,可以使用以下SQL命令:

1. 创建数据库和表:
```bash
mysql -u root -p < crawler/init_database.sql
```

2. 添加history字段(如果表已存在):
```sql
USE plant_assistant;
ALTER TABLE plants ADD COLUMN history TEXT COMMENT '植物学史' AFTER description;
```

3. 使用Python脚本导入数据

## 📊 数据库结构

### plants表字段

| 字段名 | 类型 | 说明 |
|:---|:---|:---|
| id | INT | 主键ID(自增) |
| chinese_name | VARCHAR(100) | 中文名 |
| scientific_name | VARCHAR(200) | 学名 |
| english_name | VARCHAR(100) | 英文名 |
| alias | TEXT | 别名(JSON数组) |
| family | VARCHAR(100) | 科 |
| genus | VARCHAR(100) | 属 |
| description | TEXT | 简介 |
| **history** | TEXT | **植物学史(新增)** |
| morphology | TEXT | 形态特征 |
| habitat | TEXT | 生长环境 |
| distribution | TEXT | 分布地区 |
| flowering_period | VARCHAR(50) | 花期 |
| image_url | VARCHAR(500) | 图片链接 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### 索引

- `idx_chinese_name`: 中文名索引
- `idx_scientific_name`: 学名索引
- `idx_family`: 科索引
- `ft_search`: 全文搜索索引(中文名+简介)

## ⚠️ 常见问题

### 1. 连接失败

**错误**: `❌ 连接失败: Access denied for user 'root'@'localhost'`

**解决**:
- 检查MySQL用户名和密码是否正确
- 确认MySQL服务已启动

### 2. 数据库不存在

**错误**: `Unknown database 'plant_assistant'`

**解决**:
脚本会自动创建数据库,如果失败,手动创建:
```sql
CREATE DATABASE plant_assistant CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 3. 表已存在且有数据

**提示**: `⚠️ 数据库中已有 XXX 条数据`

**选择**:
- 输入 `y`: 清空现有数据,重新导入
- 输入 `n`: 保留现有数据,追加新数据(可能导致重复)

### 4. 字段不匹配

如果原有表缺少`history`字段,脚本会自动添加。

## 📈 导入结果示例

```
🌱 植物数据导入工具
==================================================
🔧 请输入数据库配置信息:
--------------------------------------------------
数据库地址 [localhost]: 
数据库用户名 [root]: 
数据库密码: ****
数据库名 [plant_assistant]: 

✅ 成功连接到MySQL数据库 (版本: 8.0.30)

✅ plants表已存在
✅ history字段已存在

📖 正在读取 plants_1000.json...
✅ 读取到 1000 条植物数据

⏳ 开始导入数据...
   已导入 100/1000 条数据...
   已导入 200/1000 条数据...
   ...
   已导入 1000/1000 条数据...

==================================================
✅ 导入完成!
   成功: 1000 条
   失败: 0 条
==================================================

📊 数据库统计:
   总记录数: 1000

   科属分布 (Top 5):
   - 银杏科: 58 种
   - 蔷薇科: 55 种
   - 松科: 52 种
   - 兰科: 51 种
   - 毛茛科: 50 种

🔌 数据库连接已关闭
```

## 🔍 验证导入

导入完成后,可以使用以下SQL验证:

```sql
USE plant_assistant;

-- 查看总记录数
SELECT COUNT(*) FROM plants;

-- 查看前10条数据
SELECT id, chinese_name, family, genus FROM plants LIMIT 10;

-- 按科统计
SELECT family, COUNT(*) as count FROM plants GROUP BY family ORDER BY count DESC;

-- 搜索测试
SELECT chinese_name, family FROM plants WHERE chinese_name LIKE '%松%' LIMIT 5;
```

## 📝 注意事项

1. **字符编码**: 确保数据库和表使用`utf8mb4`编码
2. **数据备份**: 导入前建议备份现有数据
3. **权限**: 确保MySQL用户有CREATE、INSERT权限
4. **磁盘空间**: 1000条数据约需要2-3MB空间

---

**文件位置**:
- 数据文件: `g:\work\zhiwuzhushou-master\plants_1000.json`
- 导入脚本: `g:\work\zhiwuzhushou-master\scripts\import_plants_to_db.py`
- 表结构SQL: `g:\work\zhiwuzhushou-master\crawler\init_database.sql`
